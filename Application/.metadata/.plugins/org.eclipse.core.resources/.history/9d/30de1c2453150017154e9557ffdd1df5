package services.proposal;

import javax.inject.Inject;

import models.Proposal;
import models.ProposalVM;
import models.User;
import services.data.dao.IUserDAO;

public class ProposalBuilder {
	private ProposalVM proposalVM;
	private User authorOfProposal;
	@Inject
	private IUserDAO userDAO;
	private ProposalState proposalState;
	
	
	
	public ProposalBuilder(ProposalVM proposalVM) {
		this.proposalVM = proposalVM;
	}
	
	public void buildAuthorOfProposal() {
		
		this.authorOfProposal = userDAO.getUserById(this.proposalVM.getProposalAuthorId());
	}

	public Proposal getProposal() {
		Proposal proposal = new Proposal();
		
		proposal.setAuthorOfProposal(authorOfProposal);
		proposal.setCreationDate(new Date());
		proposal.setProposalState(this.getStateOfProposal());
		proposal.setProposalName(this.proposalVM.getProposalName());
		
		return proposal;	
	}
	
	private models.ProposalState getStateOfProposal() {
		if(this.proposalVM.getProposedWriter().isEmpty())
			return models.ProposalState.Created;
		else
		{
			proposalState = new AssignedState();
			proposalState.doAction(proposal);
			
			return models.ProposalState.Assigned;
		}
	}
}







